<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="听雷丰阳老师的 MyBatis，写个入门案例就等于学会了。">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis (二) - 核心配置文件、SQL 映射文件">
<meta property="og:url" content="http://example.com/2021/06/01/MyBatis(%E4%BA%8C)-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%81SQL%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/index.html">
<meta property="og:site_name" content="Xiao&#39;s Blog">
<meta property="og:description" content="听雷丰阳老师的 MyBatis，写个入门案例就等于学会了。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://image.kongxiao.top/image-20200607234736779.png">
<meta property="og:image" content="http://image.kongxiao.top/image-20200607234852037.png">
<meta property="og:image" content="http://image.kongxiao.top/image-20200608225144698.png">
<meta property="og:image" content="http://image.kongxiao.top/image-20210616205108153.png">
<meta property="article:published_time" content="2021-05-31T16:00:00.000Z">
<meta property="article:modified_time" content="2022-06-05T14:51:21.708Z">
<meta property="article:author" content="Kong Xiao">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://image.kongxiao.top/image-20200607234736779.png">

<link rel="canonical" href="http://example.com/2021/06/01/MyBatis(%E4%BA%8C)-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%81SQL%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MyBatis (二) - 核心配置文件、SQL 映射文件 | Xiao's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiao's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">进步之路</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">29</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">26</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/xiaokong0510" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/01/MyBatis(%E4%BA%8C)-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%81SQL%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.png">
      <meta itemprop="name" content="Kong Xiao">
      <meta itemprop="description" content="半路出家 举步维艰">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MyBatis (二) - 核心配置文件、SQL 映射文件
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-01T00:00:00+08:00">2021-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-05 22:51:21" itemprop="dateModified" datetime="2022-06-05T22:51:21+08:00">2022-06-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A1%86%E6%9E%B6/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
                </span>
            </span>

          
            <div class="post-description">听雷丰阳老师的 MyBatis，写个入门案例就等于学会了。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>MyBatis 学习笔记 (二)， 内容包括：</p>
<ol>
<li>MyBatis 入门案例</li>
<li>MyBatis 核心配置文件结构说明</li>
<li>SQL 映射文件结构说明</li>
<li>查询结果封装 resultMap</li>
</ol>
<p>学习视频：尚硅谷雷丰阳老师 MyBatis <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1bb411A7bD">https://www.bilibili.com/video/BV1bb411A7bD</a></p>
<h2 id="1-MyBatis-简介"><a href="#1-MyBatis-简介" class="headerlink" title="1. MyBatis 简介"></a>1. MyBatis 简介</h2><p>连接数据库的方法：</p>
<p><strong>工具：</strong> JDBC → Dbutils(QueryRunner) → JdbcTemplate</p>
<p><img src="http://image.kongxiao.top/image-20200607234736779.png" alt="image-20200607234736779"></p>
<p><strong>框架：</strong> 整体解决方案</p>
<p><strong>Hibernate：</strong> 全自动全映射 ORM（Object Relation Mapping）框架，旨在消除 SQL</p>
<p><img src="http://image.kongxiao.top/image-20200607234852037.png" alt="image-20200607234852037"></p>
<p>缺点：</p>
<ol>
<li><p>长难复杂 SQL，对于 Hibernate 而言处理也不容易</p>
</li>
<li><p>内部自动生产的 SQL，不容易做特殊优化。对开发人员而言，核心 SQL 还是需要自己优化 ( <strong>HQL</strong> )  </p>
</li>
<li><p>基于全映射的全自动框架，大量字段的 POJO 进行部分映射时比较困难，导致数据库性能下降</p>
</li>
</ol>
<p><strong>SQL 和 Java编码分开，功能边界清晰，一个专注业务、一个专注数据。</strong></p>
<p><strong>MyBatis：</strong> 半自动，轻量级的框架，SQL 语句提取到配置文件中编写</p>
<p><img src="http://image.kongxiao.top/image-20200608225144698.png" alt="image-20200608225144698"></p>
<ul>
<li><p>MyBatis 是一个半自动化的持久化层框架，支持自定义 SQL、存储过程以及高级映射。</p>
</li>
<li><p>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</p>
</li>
<li><p>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO映射成数据库中的记录。</p>
</li>
<li><p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/">https://github.com/mybatis/mybatis-3/</a></p>
</li>
<li><p>Maven 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>官方文档：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p>
<h2 id="2-MyBatis-入门案例"><a href="#2-MyBatis-入门案例" class="headerlink" title="2. MyBatis 入门案例"></a>2. MyBatis 入门案例</h2><p>核心步骤：</p>
<ol>
<li><p>数据库表与对应的<strong>实体类 Employee</strong> 、<strong>接口 EmployeeMapper;</strong> </p>
</li>
<li><p>全局配置文件(核心配置文件) <strong>mybatis-config.xml;</strong></p>
</li>
<li><p>根据全局配置文件创建 <strong>SqlSessionFactory</strong> 对象：</p>
<p><code>SqlSessionFactoryBulid → SqlSessionFactory → SqlSession</code></p>
</li>
<li><p>SQL 映射文件 <strong>EmployeeMapper.xml</strong>，配置了每一个 SQL，以及 SQL 的封装规则，<strong>需要在全局配置文件中注册 SQL 映射文件；</strong></p>
</li>
<li><p>由 sqlSession 对象实例执行 SQL 语句，或者获取接口的代理对象执行</p>
</li>
</ol>
<h3 id="2-1-数据库环境"><a href="#2-1-数据库环境" class="headerlink" title="2.1 数据库环境"></a>2.1 数据库环境</h3><p>创建 tbl_employee 表并插入三条数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl_employee(</span><br><span class="line">id <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,  </span><br><span class="line">last_name <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">email <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">)ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_employee <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>,&quot;zhangsan&quot;,<span class="number">0</span>,&quot;zhangsan@qq.com&quot;),</span><br><span class="line">(<span class="number">2</span>,&quot;lisi&quot;,<span class="number">0</span>,&quot;lisi@163.com&quot;),</span><br><span class="line">(<span class="number">3</span>,&quot;wangwu&quot;,<span class="number">1</span>,&quot;wangwu@126.com&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建实体类"><a href="#2-2-创建实体类" class="headerlink" title="2.2 创建实体类"></a>2.2 创建实体类</h3><ol>
<li>新建一个普通的 Maven 项目；</li>
<li>在 pom.xml 文件中导入 Maven 依赖，包括：<strong>mysql-connector-java，mybatisjuint，log4j</strong></li>
<li>创建与数据库表对应的实体类 Employee，名称与数据库表的字段保持一致。如果不一致查询会出问题，可以用别名解决</li>
</ol>
<ul>
<li>项目依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>实体类com.xiao.mybatis.entity.Employee：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String lastName; <span class="comment">//注意，该名称与数据库表的字段名不一致，查询会出现问题，可以用别名解决</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-MyBatis核心配置文件"><a href="#2-3-MyBatis核心配置文件" class="headerlink" title="2.3 MyBatis核心配置文件"></a>2.3 MyBatis核心配置文件</h3><ul>
<li><p>在 resources 目录下编写 mybatis 核心配置文件：mybatis-config.xml</p>
<p>包含信息：数据库连接参数、事务类型、注册映射文件</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis核心配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置环境组，选择默认的环境id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置单个环境并指定id为development--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--可以同时配置多个环境，但是只能选择一个使用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置事务管理类型，JDBC--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置连接池POOLED--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--数据库连接池4个参数--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置映射,注册Mapper文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;EmployeeMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<blockquote>
<p>在xml配置文件中，url中的 &amp; 符号需要写成 <code>&amp;amp;</code></p>
</blockquote>
<h3 id="2-4-sql-映射文件"><a href="#2-4-sql-映射文件" class="headerlink" title="2.4 sql 映射文件"></a>2.4 sql 映射文件</h3><p>在 resources 目录下表编写 sql 映射文件：EmployeeMapper.xml</p>
<p>sql 语句的参数用 # 获取</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--namespace:名称空间，可以绑定一个Mapper接口--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--编写sql语句--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--id：唯一标识，如果有Mapper接口文件，需要对应其中的方法名--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--resultType：对应返回结果类型--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--#&#123;id&#125;：从传递过来的参数中取出id值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xiao.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmp&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.xiao.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">        select  * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-测试"><a href="#2-5-测试" class="headerlink" title="2.5 测试"></a>2.5 测试</h3><p>根据全局配置文件创建 <strong>SqlSessionFactory</strong> 对象，</p>
<p><code>SqlSessionFactoryBulid → SqlSessionFactory → SqlSession</code>。由 sqlSession 对象实例执行 sql 语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resourceUrl</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resourceUrl);</span><br><span class="line">        <span class="comment">// SqlSessionFactoryBuilder对象获取SqlSessionFactory对象</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        <span class="comment">// 由SqlSession工厂获得SqlSession对象，使用其进行增删改查</span></span><br><span class="line">        <span class="comment">// 一个sqlSession就是和数据库的一次会话，使用完之后需要关闭资源</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession()) &#123;</span><br><span class="line">            <span class="comment">//sqlSession，直接执行已经映射的sql语句</span></span><br><span class="line">            <span class="comment">//selectOne()中两个参数：sql的唯一标识(对应sql映射文件中的namespace.id)和执行sql需要的参数</span></span><br><span class="line">            <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;com.xiao.mybatis.mapper.EmployeeMapper.selectEmp&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<blockquote>
<p>Employee{id&#x3D;1, lastName&#x3D;’null’, email&#x3D;‘<a href="mailto:&#x7a;&#104;&#x61;&#x6e;&#103;&#115;&#97;&#110;&#64;&#x71;&#x71;&#46;&#x63;&#x6f;&#x6d;">&#x7a;&#104;&#x61;&#x6e;&#103;&#115;&#97;&#110;&#64;&#x71;&#x71;&#46;&#x63;&#x6f;&#x6d;</a>‘, gender&#x3D;’0’}</p>
</blockquote>
<p>由于实体类的成员变量名和字段名不一致，因此 lastName 查询结果为 null，可以在 sql 语句中取别名解决，</p>
<p>也可以在 sql 映射文件中配置，后面会讲到。</p>
<p>修改sql语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  id,last_name lastName,gender,email <span class="keyword">from</span> tbl_employee <span class="keyword">where</span> id <span class="operator">=</span> #&#123;id&#125;</span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<blockquote>
<p>Employee{id&#x3D;1, lastName&#x3D;’zhansgan’, email&#x3D;‘<a href="mailto:&#x7a;&#104;&#x61;&#x6e;&#103;&#x73;&#97;&#x6e;&#x40;&#x71;&#x71;&#x2e;&#x63;&#111;&#109;">&#x7a;&#104;&#x61;&#x6e;&#103;&#x73;&#97;&#x6e;&#x40;&#x71;&#x71;&#x2e;&#x63;&#111;&#109;</a>‘, gender&#x3D;’0’}</p>
</blockquote>
<h3 id="2-6-接口文件"><a href="#2-6-接口文件" class="headerlink" title="2.6 接口文件"></a>2.6 接口文件</h3><p>一种更有效的方法：创建接口文件 com.xiao.mybatis.mapper.EmployeeMapper 与 sql 映射文件绑定，在接口文件中定义方法，可以声明操作的返回值和参数。</p>
<p>注意：</p>
<ol>
<li>sql 映射文件中的 namesapce 要与对应的接口文件全路径名一致</li>
<li>sql 映射文件中的 sql 语句标签中的 id 要与对应的接口文件中的方法名一致</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个查询方法</span></span><br><span class="line">    Employee <span class="title function_">selectEmp</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession()) &#123;</span><br><span class="line">    <span class="comment">//获得接口文件的代理对象，执行方法</span></span><br><span class="line">    <span class="type">EmployeeMapper</span> <span class="variable">employeeMapper</span> <span class="operator">=</span> sqlSession.getMapper(EmployeeMapper.class);</span><br><span class="line">    System.out.println(employeeMapper.selectEmp(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-几个重要类的说明"><a href="#3-几个重要类的说明" class="headerlink" title="3. 几个重要类的说明"></a>3. 几个重要类的说明</h2><h3 id="3-1-SqlSessionFactoryBuilder"><a href="#3-1-SqlSessionFactoryBuilder" class="headerlink" title="3.1 SqlSessionFactoryBuilder"></a>3.1 SqlSessionFactoryBuilder</h3><ul>
<li><p>构造器 SqlSessionFactoryBuilder ，可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。</p>
</li>
<li><p>方法： <code>build(InputStream in)</code></p>
</li>
</ul>
<h3 id="3-2-SqlSessionFactory"><a href="#3-2-SqlSessionFactory" class="headerlink" title="3.2 SqlSessionFactory"></a>3.2 SqlSessionFactory</h3><ul>
<li>SqlSession工厂，每个基于 MyBatis 的应用都以一个 SqlSessionFactory 的实例为核心，由SqlSessionFactoryBuilder 类创建。</li>
<li>SqlSessionFactory 类可以用于创建  SqlSession 类，方法：<code>openSession()</code>,传入参数 true 可以设置为自动提交事务。</li>
</ul>
<h3 id="3-3-SqlSession"><a href="#3-3-SqlSession" class="headerlink" title="3.3 SqlSession"></a>3.3 SqlSession</h3><ul>
<li>SqlSession 代表和数据库的一次会话，用完必须关闭，是非线程安全的。可以从 SqlSessionFactory 中获得 SqlSession 的实例；</li>
<li>SqlSession 提供了在数据库执行 SQL 命令所需的所有方法，可以通过 SqlSession 实例来获得映射器接口的代理对象，即接口和xml文件进行绑定。方法：<code>getMapper()</code>，需要传入 mapper 接口的 class 类型参数UserDao.class</li>
</ul>
<h3 id="3-4-作用域（Scope）和生命周期"><a href="#3-4-作用域（Scope）和生命周期" class="headerlink" title="3.4 作用域（Scope）和生命周期"></a>3.4 作用域（Scope）和生命周期</h3><ul>
<li><p><strong>SqlSessionFactoryBuilder：</strong></p>
<p>可以理解为数据库连接池对象，一旦创建了 SqlSessionFactory，就不再需要它了，因此最佳作用域是方法作用域（也就是局部方法变量）；</p>
</li>
<li><p><strong>SqlSessionFactory：</strong></p>
<p>可以理解为数据库连接对象，一旦被创建就应该在应用的运行期间一直存在，因此 SqlSessionFactory 的最佳作用域是应用作用域。使用<strong>单例模式或者静态单例模式</strong>。</p>
</li>
<li><p><strong>SqlSession：</strong></p>
<p>连接到连接池的一个请求，每个线程都有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。</p>
<p>为了确保每次都能执行关闭操作，把关闭操作放到 finally 块中。</p>
</li>
</ul>
<h2 id="4-全局配置文件"><a href="#4-全局配置文件" class="headerlink" title="4. 全局配置文件"></a>4. 全局配置文件</h2><p>约束文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。 配置文档的顶层结构如下，必须按顺序配置</p>
<ul>
<li><strong>configuration（配置）</strong><ul>
<li><strong>properties（属性）</strong></li>
<li><strong>settings（设置）</strong></li>
<li><strong>typeAliases（类型别名）</strong></li>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）</li>
<li><strong>environments（环境配置）</strong><ul>
<li>environment（环境变量）<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li>databaseIdProvider（数据库厂商标识）</li>
<li><strong>mappers（映射器）</strong></li>
</ul>
</li>
</ul>
<h3 id="4-1-属性（properties）"><a href="#4-1-属性（properties）" class="headerlink" title="4.1 属性（properties）"></a>4.1 属性（properties）</h3><p>通过 properties 属性可以实现引用配置文件，这些属性都是可以外部配置且可动态替换的</p>
<ul>
<li>可以在核心配置文件中配置数据库连接池的 4 个参数，设置好的参数可以在整个配置文件中替换需要动态配置的属性值：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">....</span><br><span class="line"><span class="comment">&lt;!--使用$&#123;name&#125;引用相应的值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<ul>
<li><p>也可以引入外部的配置文件，例如编写一个外部的配置文件 db.properties，然后在核心配置文件中引入：</p>
<ul>
<li>resource：引用类路径下的资源</li>
<li>url：引用网络路径或者磁盘路径下的资源</li>
</ul>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#外部配置文件</span></span><br><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>核心配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在核心配置文件中引入外部配置文件，然后就可以使用$&#123;name&#125;引用--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>【注意事项】：如果一个属性在不只一个地方进行了配置，那么，MyBatis 将按照下面的顺序来加载：</p>
<ul>
<li>首先读取在 properties 元素体内指定的属性。</li>
<li>然后根据 properties 元素中的 resource 属性读取类路径下属性文件，或根据 url 属性指定的路径读取属性文件，并覆盖之前读取过的同名属性。</li>
<li>最后读取作为方法参数传递的属性，并覆盖之前读取过的同名属性。</li>
</ul>
<p>因此，<strong>通过方法参数传递的属性具有最高优先级，resource&#x2F;url 属性中指定的配置文件次之，最低优先级的则是 properties 元素中指定的属性。</strong></p>
<h3 id="4-2-设置（settings）"><a href="#4-2-设置（settings）" class="headerlink" title="4.2 设置（settings）"></a>4.2 设置（settings）</h3><p>是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。</p>
<p>常用设置：</p>
<ul>
<li>mapUnderscoreToCamelCase：是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn，默认为flase</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>jdbcTypeForNull：当没有为参数指定特定的 JDBC 类型时，空值的默认 JDBC 类型。默认是 OTHER，但是如果用Oracle数据库，需要改为NULL</li>
<li>autoMappingBehavior：指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套），默认为PARTIAL</li>
<li>lazyLoadingEnabled：延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。默认是false</li>
<li>aggressiveLazyLoading：开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载。</li>
<li>cacheEnabled：全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。默认为true，配置二级缓存的开关。一级缓存一直是打开的</li>
<li>localCacheScope：MyBatis 的本地缓存机制，默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。</li>
</ul>
<h3 id="4-3-类型别名（typeAliases）"><a href="#4-3-类型别名（typeAliases）" class="headerlink" title="4.3 类型别名（typeAliases）"></a>4.3 类型别名（typeAliases）</h3><p>类型别名可为 Java 类型设置一个缩写名字。 仅用于 XML 配置，意在降低冗余的全限定类名书写。别名不区分大小写</p>
<ul>
<li><p>单个类起别名，<code>&lt;typeAlias&gt;</code>标签：</p>
<ul>
<li>type：指定要起别名的类型全类名，默认是类名小写employee(其实不区分大小写)</li>
<li>alias：指定新的别名</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- type:指定要起别名的类型全类名，默认是类名小写employee--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- alias:指定新的别名--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.xiao.mybatis.entity.Employee&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;employee&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>批量起别名，用<code>&lt;package&gt;</code>标签，</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.xiao.mybatis.entity&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>批量情况下，如果指定包下的子包中有同名的类，会产生冲突，可以使用注解解决：在实体类上注解<code>@Alias</code>，则别名为其注解值：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;Emp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见的 Java 类型内建的类型别名。它们都是不区分大小写的，自定义的别名不要与其重复。</p>
<p>基本类型前面加下划线，引用类型首字母小写：</p>
<table>
<thead>
<tr>
<th align="left">别名</th>
<th align="left">映射的类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">_byte</td>
<td align="left">byte</td>
</tr>
<tr>
<td align="left">_long</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">_short</td>
<td align="left">short</td>
</tr>
<tr>
<td align="left">_int</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">_integer</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">_double</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">_float</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">_boolean</td>
<td align="left">boolean</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">String</td>
</tr>
<tr>
<td align="left">byte</td>
<td align="left">Byte</td>
</tr>
<tr>
<td align="left">long</td>
<td align="left">Long</td>
</tr>
<tr>
<td align="left">short</td>
<td align="left">Short</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">Integer</td>
</tr>
<tr>
<td align="left">integer</td>
<td align="left">Integer</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">Double</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left">Float</td>
</tr>
<tr>
<td align="left">boolean</td>
<td align="left">Boolean</td>
</tr>
<tr>
<td align="left">date</td>
<td align="left">Date</td>
</tr>
<tr>
<td align="left">decimal</td>
<td align="left">BigDecimal</td>
</tr>
<tr>
<td align="left">bigdecimal</td>
<td align="left">BigDecimal</td>
</tr>
<tr>
<td align="left">object</td>
<td align="left">Object</td>
</tr>
<tr>
<td align="left">map</td>
<td align="left">Map</td>
</tr>
<tr>
<td align="left">hashmap</td>
<td align="left">HashMap</td>
</tr>
<tr>
<td align="left">list</td>
<td align="left">List</td>
</tr>
<tr>
<td align="left">arraylist</td>
<td align="left">ArrayList</td>
</tr>
<tr>
<td align="left">collection</td>
<td align="left">Collection</td>
</tr>
<tr>
<td align="left">iterator</td>
<td align="left">Iterator</td>
</tr>
</tbody></table>
<h3 id="4-4-类型处理器（typeHandlers）"><a href="#4-4-类型处理器（typeHandlers）" class="headerlink" title="4.4 类型处理器（typeHandlers）"></a>4.4 类型处理器（typeHandlers）</h3><p>数据库里的字段类型与Java的数据类型进行映射。</p>
<p>在设置预处理语句（PreparedStatement）中的参数或从结果集中取出一个值时， 都会用类型处理器将获取到的值以合适的方式转换成 Java 类型。</p>
<h3 id="4-5-插件（plugins）"><a href="#4-5-插件（plugins）" class="headerlink" title="4.5 插件（plugins）"></a>4.5 插件（plugins）</h3><p>MyBatis 允许在映射语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
<li>参数处理器：ParameterHandler (getParameterObject, setParameters)</li>
<li>ResultSetHandler (handleResultSets, handleOutputParameters)</li>
<li>sql语句处理器：StatementHandler (prepare, parameterize, batch, update, query)</li>
</ul>
<h3 id="4-6-环境配置（environments）"><a href="#4-6-环境配置（environments）" class="headerlink" title="4.6 环境配置（environments）"></a>4.6 环境配置（environments）</h3><p>MyBatis 可以配置成适应多种环境，<strong>可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong> default参数指定使用某种环境。</p>
<ul>
<li><strong>transactionManager：事务管理器</strong>，有两种类型，type&#x3D;”[JDBC|MANAGED]”，默认的事务管理器就是JDBC。也可以自定义事务管理器：实现TransactionFactory接口，type指定为全类名</li>
</ul>
<ul>
<li><strong>dataSource：数据源</strong>，有三种内建的数据源类型， type&#x3D;”[UNPOOLED|POOLED|JNDI]”），也可以自己实现DataSourceFactory接口自定义数据源</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">  &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">    &lt;transactionManager type=&quot;JDBC&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;...&quot; value=&quot;...&quot;/&gt;</span><br><span class="line">    &lt;/transactionManager&gt;</span><br><span class="line">    &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">    &lt;/dataSource&gt;</span><br><span class="line">  &lt;/environment&gt;</span><br><span class="line">&lt;/environments&gt;</span><br></pre></td></tr></table></figure>

<p>【注意事项】：</p>
<ul>
<li>默认使用的环境 id（比如：default&#x3D;”development”）。</li>
<li>每个 environment 元素定义的环境 id（比如：id&#x3D;”development”）。</li>
<li>事务管理器的配置（比如：type&#x3D;”JDBC”）。</li>
<li>数据源的配置（比如：type&#x3D;”POOLED”）。</li>
</ul>
<h3 id="4-7-数据库厂商标识（databaseIdProvider）"><a href="#4-7-数据库厂商标识（databaseIdProvider）" class="headerlink" title="4.7 数据库厂商标识（databaseIdProvider）"></a>4.7 数据库厂商标识（databaseIdProvider）</h3><p>MyBatis 可以根据不同的数据库厂商执行不同的语句，考虑了移植性。</p>
<p>得到数据库厂商的标识(驱动getDatabaseProductName())，MyBatis就能根据数据库厂商标识来执行不同的sql。</p>
<ol>
<li>为不同的数据库的厂商标识取别名：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;SQL Server&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlserver&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DB2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查询语句标签中指定databaseId元素值，会优先执行带该标识的，不带标签的语句会舍弃</li>
</ol>
<h3 id="4-8-映射器（mappers）"><a href="#4-8-映射器（mappers）" class="headerlink" title="4.8 映射器（mappers）"></a>4.8 映射器（mappers）</h3><p>需要告诉 MyBatis 到哪里去找到 sql语句。可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 <code>file:///</code> 形式的 URL），或类名和包名等</p>
<ul>
<li>resource：指定sql映射文件的路径</li>
<li>url：使用网上的资源或者使用本地磁盘路径上的文件</li>
<li>class：注册接口，<strong>如果有sql映射文件，映射文件必须和接口同目录同名</strong>；也可以在接口方法上写注解，这样就不需要sql映射文件，</li>
<li>package：批量注册，将包内的映射器接口实现全部注册为映射器，作用同class</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>   </span><br></pre></td></tr></table></figure>

<p>在dao接口文件中，用注解实现查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个查询方法</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_employee where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Employee <span class="title function_">selectEmployeeById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>【一个小坑】：</p>
<ol>
<li><p><strong>class：注册接口，如果有sql映射文件，映射文件必须和接口同目录同名</strong></p>
</li>
<li><p>在resources中建立多级目录时，用 &#x2F; 隔开，但是创建完后显示的是 . 。如果新建目录时用  .会出错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置映射,注册Mapper文件--&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper class=&quot;com.xiao.mybatis.mapper.EmployeeMapper&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img src="http://image.kongxiao.top/image-20210616205108153.png" alt="image-20210616205108153"></p>
<h2 id="5-映射文件"><a href="#5-映射文件" class="headerlink" title="5. 映射文件"></a>5. 映射文件</h2><p>映射文件指导MyBatis如何进行数据库增删改。</p>
<h3 id="5-1-基本的增删改查"><a href="#5-1-基本的增删改查" class="headerlink" title="5.1 基本的增删改查"></a>5.1 基本的增删改查</h3><ul>
<li>insert –- 映射插入语句</li>
<li>update –- 映射更新语句</li>
<li>delete –- 映射删除语句</li>
<li>select –- 映射查询语句</li>
</ul>
<ol>
<li>首先在接口文件com.xiao.mybatis.mapper.EmployeeMapper中声明对应的增删改查方法，<br>同时可以设置返回值类型Integer、Long、Boolean，表示被影响的行数</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个查询方法</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_employee where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Employee <span class="title function_">selectEmployeeById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addEmp</span><span class="params">(Employee employee)</span>;</span><br><span class="line">    <span class="comment">//根据id删除</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="comment">//修改</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateEmp</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后在sql映射文件EmployeeMapper.xml中编写相应的sql语句</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--parameterType:参数类型，可以省略--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">       insert into tbl_employee (last_name, gender, email) value (#&#123;lastName&#125;,#&#123;gender&#125;,#&#123;email&#125;)</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteEmpById&quot;</span>&gt;</span></span><br><span class="line">       delete from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmp&quot;</span>&gt;</span></span><br><span class="line">       update tbl_employee set last_name=#&#123;lastName&#125;,email=#&#123;email&#125;,gender=#&#123;gender&#125;</span><br><span class="line">       where id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>测试：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line">    <span class="comment">// 默认不自动提交事务，需要手动提交，或者构造方法传入true</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="keyword">try</span>(<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession()) &#123;</span><br><span class="line">        <span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmployeeMapper.class);</span><br><span class="line">        <span class="comment">//增</span></span><br><span class="line">        mapper.addEmp(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">4</span>,<span class="string">&quot;林青霞&quot;</span>,<span class="string">&quot;lingqingxia@163.com&quot;</span>,<span class="string">&quot;1&quot;</span>));</span><br><span class="line">        <span class="comment">//删</span></span><br><span class="line">        mapper.deleteEmpById(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//改</span></span><br><span class="line">        mapper.updateEmp(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>,<span class="string">&quot;张柏芝&quot;</span>,<span class="string">&quot;zhangbozhi@qq.com&quot;</span>,<span class="string">&quot;1&quot;</span>));</span><br><span class="line">        <span class="comment">// 手动提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项：增删改需要提交事务</strong></p>
<p>sqlSessionFactory.openSession()：需要手动提交， sqlSession.commit();</p>
<p>sqlSessionFactory.openSession(true) 是自动提交事务的</p>
<h3 id="5-2-获取自增主键的值"><a href="#5-2-获取自增主键的值" class="headerlink" title="5.2 获取自增主键的值"></a>5.2 获取自增主键的值</h3><p>MySQL 支持自增主键，在 MyBatis 中也是使用 statement.getGeneratedKeys() 获取自增主键的值。</p>
<p>用法，insert 标签中增加属性</p>
<ul>
<li><p>useGeneratedKeys&#x3D;”true”：使用自增主键获取主键值策略</p>
</li>
<li><p>keyProperty&#x3D;”id”：获取到的主键封装给 JavaBean 的 id 属性</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--useGeneratedKeys=&quot;true&quot;:使用自增主键获取主键值策略--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--keyProperty=&quot;id&quot;:获取到的主键封装给JavaBean的id属性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;employee&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into tbl_employee (last_name, gender, email) value (#&#123;lastName&#125;,#&#123;gender&#125;,#&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试：employee.getId() 方法可以获取到自增的主键值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="literal">null</span>,<span class="string">&quot;Tom&quot;</span>,<span class="string">&quot;tom@126.com&quot;</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line">mapper.addEmp(employee);</span><br><span class="line">System.out.println(employee.getId());</span><br></pre></td></tr></table></figure>

<h3 id="5-3-参数处理"><a href="#5-3-参数处理" class="headerlink" title="5.3 参数处理"></a>5.3 参数处理</h3><p>取参数的方式：#{参数名}</p>
<h4 id="01-单个参数"><a href="#01-单个参数" class="headerlink" title="01 单个参数"></a>01 单个参数</h4><p>MyBatis 不会做处理，传入 id，sql 语句中写 #{idabc} 也能取到参数</p>
<h4 id="02-多个参数"><a href="#02-多个参数" class="headerlink" title="02 多个参数"></a>02 多个参数</h4><p>会被封装成一个 map，#{}就是从 map 中获取指定 key 值的 value。</p>
<p>key：param1,…paramN，或者参数的索引也可以</p>
<p>value：传入的参数值</p>
<p>如果按照之前的写法会报异常：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Employee employee = mapper.selectEmpByIdAndName(6, &quot;Tom&quot;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmpByIdAndName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">      select  * from tbl_employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>BindingException: Parameter ‘id’ not found. Available parameters are [arg1, arg0, param1, param2]</p>
</blockquote>
<p>正确写法，但是一般不这么用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select  * from tbl_employee where id = #&#123;param1&#125; and last_name=#&#123;param2&#125;</span><br></pre></td></tr></table></figure>

<p><strong>常规用法：在接口方法中加注解<code>@Param</code>：</strong> 相当于 key 中保存的是 @Param 注解指定的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Employee <span class="title function_">selectEmpByIdAndName</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id, <span class="meta">@Param(&quot;lastName&quot;)</span> String lastName)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="03-传入对象"><a href="#03-传入对象" class="headerlink" title="03 传入对象"></a>03 传入对象</h4><ul>
<li><p>如果多个参数正好是业务逻辑的数据模型，就可以直接传入 POJO，#{属性名}取出传入的POJO的属性值</p>
</li>
<li><p>如果不是业务模型中的数据，没有对应的 POJO，也可以传入 map，#{key} 取出 map 中对应的值，或者编写一个 TO(Transfer Object) 数据传输对象。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//封装传入参数为Map,查询</span></span><br><span class="line">Employee <span class="title function_">selectEmpByMap</span><span class="params">(Map&lt;String,Object&gt; map)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//注意sql语句中#&#123;id&#125;,#&#123;lastName&#125;与map中的键字段名称一一对应</span></span><br><span class="line">map.put(<span class="string">&quot;id&quot;</span>,<span class="number">6</span>);</span><br><span class="line">map.put(<span class="string">&quot;lastName&quot;</span>,<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"><span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> mapper.selectEmpByMap(map);</span><br><span class="line">System.out.println(employee);</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select  * from tbl_employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br></pre></td></tr></table></figure>

<h4 id="04-几种情况小结"><a href="#04-几种情况小结" class="headerlink" title="04 几种情况小结"></a>04 几种情况小结</h4><ol>
<li><p><code>Employee getEmp(@Param(&quot;id&quot;) Integer id, String lastName)</code></p>
<p>取值：id &#x3D;&#x3D;&gt; #{id} 或者 #{param1}，lastName  &#x3D;&#x3D;&gt; #{param2}</p>
</li>
<li><p><code>Employee getEmp(Integer id, @Param(&quot;e&quot;) Employee emp)</code></p>
<p>取值：id &#x3D;&#x3D;&gt; #{param1}，lastName  &#x3D;&#x3D;&gt; #{e.lastName} 或者 #{param2.lastName}</p>
</li>
<li><p>如果传入的是 Collection 类型或者是数组，则会把传入的集合或者数组封装在 map 中</p>
<p>key：collection，list，array</p>
<p><code>Employee getEmp(List&lt;Integer&gt; ids)</code></p>
<p>取值：取出第一个 id 的值 #{list[0]}</p>
</li>
</ol>
<p>总结：参数多时封装成 map，结合@Param 指定封装时使用的 key，#{key} 取出 map 中的值</p>
<h4 id="05-和-的区别"><a href="#05-和-的区别" class="headerlink" title="05 #{}和${}的区别"></a>05 #{}和${}的区别</h4><ul>
<li><p><code>#&#123;&#125;</code>：是以预编译的形式，即占位符，将参数设置到 sql 语句中，类似于 JDBC 中的 PreparedStament，防止 sql 注入</p>
</li>
<li><p><code>$&#123;&#125;</code>：取出的值直接拼装在sql语句中，会有安全问题。</p>
<p>原生 JDBC 中不支持占位符的地方就可以用 ${取值}，比如表名、排序字段等</p>
<p>select * from ${year}_salary where …</p>
<p>select * from tbl_employee order by ${name}</p>
<blockquote>
<p>注意：MyBatis 的 xml文件，排序时使用order by 动态参数时需要注意，用$而不是#</p>
</blockquote>
</li>
</ul>
<h3 id="5-4-select的结果映射"><a href="#5-4-select的结果映射" class="headerlink" title="5.4 select的结果映射"></a>5.4 select的结果映射</h3><h4 id="01-返回的是集合"><a href="#01-返回的是集合" class="headerlink" title="01 返回的是集合"></a>01 返回的是集合</h4><p>select 语句中 resultType 写的是集合中元素的类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询所有，返回一个集合</span></span><br><span class="line">List&lt;Employee&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    select  * from tbl_employee</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Employee&gt; employees = mapper.selectAll();</span><br><span class="line"><span class="keyword">for</span> (Employee employee : employees) &#123;</span><br><span class="line">    System.out.println(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee&#123;<span class="attribute">id</span>=1, <span class="attribute">lastName</span>=<span class="string">&#x27;张曼玉&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;zhangmanyu@163.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">Employee&#123;<span class="attribute">id</span>=3, <span class="attribute">lastName</span>=<span class="string">&#x27;wangwu&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;wangwu@126.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line">Employee&#123;<span class="attribute">id</span>=5, <span class="attribute">lastName</span>=<span class="string">&#x27;林青霞&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;lingqingxia@163.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">Employee&#123;<span class="attribute">id</span>=6, <span class="attribute">lastName</span>=<span class="string">&#x27;Tom&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;tom@126.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;0&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="02-返回一条记录的map"><a href="#02-返回一条记录的map" class="headerlink" title="02 返回一条记录的map"></a>02 返回一条记录的map</h4><p>如果想把一条记录的返回值类型封装为 Map ，key 值为字段名，value 值。则指定 resultType  为 Map ，查询到的结果会将指定的列映射到 Map 的键上，结果映射到值上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回一条记录的map，key是列名，值就是对应的值</span></span><br><span class="line">Map&lt;String,Object&gt; <span class="title function_">selectEmpByIdToMap</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询并返回一条记录的map--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmpByIdToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">        select * from tbl_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = mapper.selectEmpByIdToMap(<span class="number">1</span>);</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attribute">gender</span>=1, <span class="attribute">last_name</span>=张曼玉, <span class="attribute">id</span>=1, <span class="attribute">email</span>=zhangmanyu@163.com&#125;</span><br></pre></td></tr></table></figure>

<h4 id="03-多条记录封装为map"><a href="#03-多条记录封装为map" class="headerlink" title="03 多条记录封装为map"></a>03 多条记录封装为map</h4><p>如果想封装多条记录到 map 中，key 是主键值，value 是 JavaBean 对象，则在接口方法上使用 @MapKey 注解指定 key 的属性； resultType 依然为 map 中的 value 类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回多条记录封装到map中，key是主键值，value是JavaBean对象</span></span><br><span class="line"><span class="comment">//@MapKey；指定返回的map的key</span></span><br><span class="line"><span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line">Map&lt;Integer,Employee&gt; <span class="title function_">selectAllToMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 返回多条记录封装到map中，key是主键值，value是JavaBean对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">        select * from tbl_employee</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Employee&gt; map = mapper.selectAllToMap();</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attribute">1</span>=Employee&#123;<span class="attribute">id</span>=1, <span class="attribute">lastName</span>=<span class="string">&#x27;张曼玉&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;zhangmanyu@163.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;1&#x27;</span>&#125;, <span class="attribute">3</span>=Employee&#123;<span class="attribute">id</span>=3, <span class="attribute">lastName</span>=<span class="string">&#x27;wangwu&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;wangwu@126.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;0&#x27;</span>&#125;, <span class="attribute">5</span>=Employee&#123;<span class="attribute">id</span>=5, <span class="attribute">lastName</span>=<span class="string">&#x27;林青霞&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;lingqingxia@163.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;1&#x27;</span>&#125;, <span class="attribute">6</span>=Employee&#123;<span class="attribute">id</span>=6, <span class="attribute">lastName</span>=<span class="string">&#x27;Tom&#x27;</span>, <span class="attribute">email</span>=<span class="string">&#x27;tom@126.com&#x27;</span>, <span class="attribute">gender</span>=<span class="string">&#x27;0&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>而指定 <code>resultType</code> 属性为实体类时，查询到的结果会将指定的列映射到类的成员变量名上，结果映射到成员变量值上。</p>
<p><strong>【注意】：实体类中的属性名和数据库中的字段名保持一致。否则结果值会为null。</strong></p>
<p>如果列名和属性名不能匹配上，且不满足驼峰命名自动映射，可以在 SELECT 语句中设置列别名，<strong>也可以显式配置 <code>ResultMap</code></strong></p>
<h4 id="04-自定义ResultMap"><a href="#04-自定义ResultMap" class="headerlink" title="04 自定义ResultMap"></a>04 自定义ResultMap</h4><p>如果列名和属性名不能匹配上，在xml映射文件中显式配置 <code>ResultMap</code>标签</p>
<ul>
<li>type：自定义规则的Java类型</li>
<li>id：唯一id，用于引用</li>
<li><strong>column：指定数据库中的字段</strong></li>
<li><strong>property：指定对应的JavaBean中的属性</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--自定义结果集规则--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--type:自定义规则的Java类型--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--id:唯一id，用于引用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;MyEmp&quot;</span> <span class="attr">type</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用id标签定义主键底层会有优化，普通列用result标签--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--column：指定哪一列--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--property:指定对应的JavaBean属性--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--不指定的列会自动封装--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--用resultMap取代resultType，值为自命名的id--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmp&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyEmp&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tbl_employee</span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MyBatis/" rel="tag"># MyBatis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/05/31/MyBatis(%E4%B8%80)-%E5%8E%9F%E7%94%9FJDBC/" rel="prev" title="MyBatis (一) - 原生 JDBC">
      <i class="fa fa-chevron-left"></i> MyBatis (一) - 原生 JDBC
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/03/MyBatis(%E4%B8%89)-%E9%AB%98%E7%BA%A7%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84association%E3%80%81collection/" rel="next" title="MyBatis (三) - 高级结果映射 association、collection">
      MyBatis (三) - 高级结果映射 association、collection <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-MyBatis-%E7%AE%80%E4%BB%8B"><span class="nav-text">1. MyBatis 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-MyBatis-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">2. MyBatis 入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83"><span class="nav-text">2.1 数据库环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-text">2.2 创建实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-MyBatis%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">2.3 MyBatis核心配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-sql-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-text">2.4 sql 映射文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%B5%8B%E8%AF%95"><span class="nav-text">2.5 测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E6%8E%A5%E5%8F%A3%E6%96%87%E4%BB%B6"><span class="nav-text">2.6 接口文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E7%B1%BB%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="nav-text">3. 几个重要类的说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-SqlSessionFactoryBuilder"><span class="nav-text">3.1 SqlSessionFactoryBuilder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-SqlSessionFactory"><span class="nav-text">3.2 SqlSessionFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-SqlSession"><span class="nav-text">3.3 SqlSession</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E4%BD%9C%E7%94%A8%E5%9F%9F%EF%BC%88Scope%EF%BC%89%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">3.4 作用域（Scope）和生命周期</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">4. 全局配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%B1%9E%E6%80%A7%EF%BC%88properties%EF%BC%89"><span class="nav-text">4.1 属性（properties）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E8%AE%BE%E7%BD%AE%EF%BC%88settings%EF%BC%89"><span class="nav-text">4.2 设置（settings）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%EF%BC%88typeAliases%EF%BC%89"><span class="nav-text">4.3 类型别名（typeAliases）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%88typeHandlers%EF%BC%89"><span class="nav-text">4.4 类型处理器（typeHandlers）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E6%8F%92%E4%BB%B6%EF%BC%88plugins%EF%BC%89"><span class="nav-text">4.5 插件（plugins）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%EF%BC%88environments%EF%BC%89"><span class="nav-text">4.6 环境配置（environments）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%82%E5%95%86%E6%A0%87%E8%AF%86%EF%BC%88databaseIdProvider%EF%BC%89"><span class="nav-text">4.7 数据库厂商标识（databaseIdProvider）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-%E6%98%A0%E5%B0%84%E5%99%A8%EF%BC%88mappers%EF%BC%89"><span class="nav-text">4.8 映射器（mappers）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-text">5. 映射文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="nav-text">5.1 基本的增删改查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC"><span class="nav-text">5.2 获取自增主键的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="nav-text">5.3 参数处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="nav-text">01 单个参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="nav-text">02 多个参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#03-%E4%BC%A0%E5%85%A5%E5%AF%B9%E8%B1%A1"><span class="nav-text">03 传入对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#04-%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%E5%B0%8F%E7%BB%93"><span class="nav-text">04 几种情况小结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#05-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">05 #{}和${}的区别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-select%E7%9A%84%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><span class="nav-text">5.4 select的结果映射</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E9%9B%86%E5%90%88"><span class="nav-text">01 返回的是集合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-%E8%BF%94%E5%9B%9E%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%E7%9A%84map"><span class="nav-text">02 返回一条记录的map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#03-%E5%A4%9A%E6%9D%A1%E8%AE%B0%E5%BD%95%E5%B0%81%E8%A3%85%E4%B8%BAmap"><span class="nav-text">03 多条记录封装为map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#04-%E8%87%AA%E5%AE%9A%E4%B9%89ResultMap"><span class="nav-text">04 自定义ResultMap</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kong Xiao"
      src="/images/author.png">
  <p class="site-author-name" itemprop="name">Kong Xiao</p>
  <div class="site-description" itemprop="description">半路出家 举步维艰</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiaokong0510" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiaokong0510" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kongxiao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
